---
type: "docs"
title: "Reactions"
linkTitle: "Reactions"
weight: 30
description: >
    Reactions for Solution Developers
---

**The Drasi Preview is a prototype and is only suitable for experimentation, not for production systems.**


Reactions process the stream of query result updates generated by one or more Continuous Queries.

Drasi currently provides the following Reaction implementations:

- [Event Grid](#event-grid-reaction)
- [SignalR](#signalr-reaction)
- [Gremlin](#gremlin-reaction)
- [SQL Stored Procedure](#sql-stored-procedure-reaction)
- [Debug](#debug-reaction)

*To create other Reactions, see the [Platform Developer Guide](/platform-developer)*

To create a Reaction instance, you must:

1. Have ID's and credentials that provide access to the Continuous Queries the Reaction will subscribe to.
1. Have credentials and endpoint addresses that provide access to any external system the Reaction interacts with.
1. Create a file containing the Kubernetes resource definition for the Reaction.
1. Apply the Reaction resource definition to the Kubernetes cluster where your Drasi environment is deployed.

The Kubernetes resource definition for a Reaction has the following structure:

  ```yaml
  apiVersion: query.reactive-graph.io/v1
  kind: Reactor
  metadata:
    name: (your reaction name)
  spec:
    reactorImage: (your docker image)
    queries:
      - queryId: (a query you want to react to)
        options: >
          some custom metadata for your query (optional)
    properties:
      - name: (some env variable to be mounted)
        value: (value of env variable)
      - name: (some secret env variable to be mounted)
        valueFrom:
          secretKeyRef:
            name: (name of secret)
            key: (name of key)
    endpoints:
      - name: (name of a port you want to expose (optional))
        port: 8080
    daprAppPort: 80 (optional override, default = 80)
  ```

- A volume will be mounted at `/etc/queries` where each file will be the name of a query and the contents of each file will be custom metadata.
- All the key/value pairs from `properties` will be mounted as environment variables.  You can also reference secrets and config maps as you would normally do with environment variables.
- Any entries in `endpoints` will create a network service with the name `<reaction name>-<endpoint name>` and map to the container port specified in `port`
- The Dapr server within your reaction should listen on port 80, this can be overridden with `daprAppPort`
  
The **source-id** must be unique within the scope of the Drasi envionment, and is the ID used in a Continuous Query definition to describe which Sources the Continuous Query uses as input.

The following sections describe the configuration of the Source types currently supported by Drasi.

## Event Grid Reaction
The Event Grid Reaction requires the following configuration settings:

|Name|Type|Description|
|-|-|-|
|reactorImage| | Must have the value **reactive-graph/eventgrid-reactor**|
|EventGridUri| Property | |
|EventGridKey| Property | |

The following is an example of a fully configured Event Grid Reaction using Kubernetes Secrets to securely store sensitive information:

```yaml
apiVersion: v1
kind: Secret
metadata:
  name: credentials
type: Opaque
stringData:
  access-key: xxxxxx
---
apiVersion: query.reactive-graph.io/v1
kind: Reactor
metadata:
  name: eventgrid1
spec:
  reactorImage: reactive-graph/eventgrid-reactor
  properties:
    - name: EventGridUri
      value: https://reactive-graph-daniel.westus-1.eventgrid.azure.net/api/events
    - name: EventGridKey
      valueFrom:
        secretKeyRef:
          name: credentials
          key: access-key
  queries:
    - queryId: my-query1
```

## SignalR Reaction
The SignalR Reaction requires the following configuration settings:

|Name|Type|Description|
|-|-|-|
|reactorImage| | Must have the value **reactive-graph/signalr-reactor**|
|AzureSignalRConnectionString| Property | |
|gateway| Endpoint | |

The following is an example of a fully configured Event Grid Reaction using Kubernetes Secrets to securely store sensitive information:

```yaml
apiVersion: v1
kind: Secret
metadata:
  name: credentials
type: Opaque
stringData:
  connection-string: xxxxxx
---
apiVersion: query.reactive-graph.io/v1
kind: Reactor
metadata:
  name: signalr1
spec:
  reactorImage: reactive-graph/signalr-reactor
  properties:
    - name: AzureSignalRConnectionString
      valueFrom:
        secretKeyRef:
          name: credentials
          key: connection-string
  endpoints:
    - name: gateway
      port: 8080
  queries:
    - queryId: my-query1
```

## Gremlin Reaction
TODO

## SQL Stored Procedure Reaction
TODO

## Debug Reaction
TODO
