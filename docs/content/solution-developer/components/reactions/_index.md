---
type: "docs"
title: "Reactions"
linkTitle: "Reactions"
weight: 60
description: >
    What are Reactions and How to Use Them
---

Reactions process the stream of query result changes output by one or more Continuous Queries and act on them. 

{{< figure src="simple-end-to-end.png" alt="End to End" width="65%" >}}

The action taken depends on the Reaction type being used. Drasi currently provides the following Reactions:

- [Azure Event Grid](#event-grid-reaction), to forward Continuous Query results to Azure Event Grid, which in turn enables integration with any application, service, or function that can receive updates from Azure Event Grid.
- [Debug](#debug-reaction), a tool to help developers inspect the results generated by Continuous Queries.
- [SignalR](#signalr-reaction), to forward Continuos Query results to Web Applications.
- [Gremlin](#gremlin-reaction), to use the Continuous Query results as parameters to commands that run against a Gremlin database.

*To create custom Reactions, see the [Custom Reactions](/platform-developer/reactions/) section of the [Platform Developer Guide](/platform-developer)*

## Creation
Reactions are custom Kubernetes resources that you can create and manage using `Kubectl`. 

The easiest way to create a Reaction, and the way you will often create one as part of a broader software solution, is to:

1. Collect ID's of the Continuous Queries the Reaction will subscribe to.
1. Collect credentials and endpoint addresses that provide access to any external system the Reaction interacts with.
1. Create a YAML file containing the Reaction Resource Definition. This will include the configuration settings that enable the Reaction to connect to external systems. This can be stored in your solution repo and versioned along with all the other solution code / resources.
1. Run Kubectl to apply the Reaction resource definition to the Kubernetes cluster where your Drasi environment is deployed.

As soon as the Reaction is created it will start running, subscribing to its Continuous Queries and processing query result changes.

The Kubernetes resource definition for a Reaction has the following structure:

```
apiVersion: query.reactive-graph.io/v1
kind: Reaction
metadata:
  name: <reaction-id>
spec:
  reactionImage: <reaction-image>
  queries:
    - queryId: <query_id_1
    - queryId: <query_id_2
      options: <custom metadata for query_id_2 (optional)>
  properties:
    - name: <property_1_name>
      value: <property_1_value>
    - name: <property_2_value>
      valueFrom:
        secretKeyRef:
          name: <secret_id>
          key: <secret_key>
  endpoints:
    - name: <endpoint_name (optional)>
      port: <enpoint_port_num>
```

The following table provides a summary of these configuration settings:

|Name|Description|
|-|-|
|apiVersion|Must have the value **query.reactive-graph.io/v1**|
|kind|Must have the value **Reaction**|
|metadata.name|The **id** of the Reaction. Must be unique within the scope of the Reactions in the Drasi deployment. The  **id** is used to manage the Reaction through Kubectl.|
|spec.reactionImage|The name of the docker image for the Reaction.|
|spec.queries|The list of Continuous Query IDs the Reaction will subscribe to. Some Reactions also need per-query configuration, which can be passed using the options property of the queryId. These are unique to the type of Reaction and are detailed in the sections below.|
|spec.properties|Name/value pairs used to configure the Reaction. These are unique to the type of Reaction and are detailed in the sections below.|
|spec.endpoints|Names and port numbers to use for Reactions that expose accessible ports for clients to connect to.|  

Once configured, to create a Reaction defined in a file called `reaction.yaml`, you would run the command:

```
kubectl apply -f reaction.yaml
```

You can then use the standard Kubectl commands to query the existence and status of the Reaction resource. For example, to see a list of the active Reactions, run the following command:

```
kubectl get reactions
```

## Deletion
To delete an active Reaction, run the following command:

```
kubectl delete reaction <reaction-id>
```

For example, if the Reaction ID is `update-gremlin`, you would run,

```
kubectl delete reaction update-gremlin
```

## Configuring Reactions
The following sections describe the configuration of the Reaction types currently supported by Drasi.

### Azure Event Grid Reaction
The Event Grid Reaction requires the following configuration settings:

|Name|Type|Description|
|-|-|-|
|reactionImage| | Must have the value **reactive-graph/reaction-eventgrid**|
|EventGridUri| Property | |
|EventGridKey| Property | |

The following is an example of a fully configured Event Grid Reaction using Kubernetes Secrets to securely store sensitive information:

```
apiVersion: v1
kind: Secret
metadata:
  name: credentials
type: Opaque
stringData:
  access-key: xxxxxx
---
apiVersion: query.reactive-graph.io/v1
kind: Reaction
metadata:
  name: eventgrid1
spec:
  reactionImage: reactive-graph/reaction-eventgrid
  properties:
    - name: EventGridUri
      value: https://reactive-graph-daniel.westus-1.eventgrid.azure.net/api/events
    - name: EventGridKey
      valueFrom:
        secretKeyRef:
          name: credentials
          key: access-key
  queries:
    - queryId: my-query1
```

### Gremlin Reaction
TODO

### SignalR Reaction
The SignalR Reaction requires the following configuration settings:

|Name|Type|Description|
|-|-|-|
|reactionImage| | Must have the value **reactive-graph/reaction-signalr**|
|AzureSignalRConnectionString| Property | |
|gateway| Endpoint | |

The following is an example of a fully configured Event Grid Reaction using Kubernetes Secrets to securely store sensitive information:

```
apiVersion: v1
kind: Secret
metadata:
  name: credentials
type: Opaque
stringData:
  connection-string: xxxxxx
---
apiVersion: query.reactive-graph.io/v1
kind: Reaction
metadata:
  name: signalr1
spec:
  reactionImage: reactive-graph/reaction-signalr
  properties:
    - name: AzureSignalRConnectionString
      valueFrom:
        secretKeyRef:
          name: credentials
          key: connection-string
  endpoints:
    - name: gateway
      port: 8080
  queries:
    - queryId: my-query1
```

### Debug Reaction
TODO
